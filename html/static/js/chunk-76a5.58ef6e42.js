(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-76a5"],{"/umX":function(e,t,i){"use strict";t.__esModule=!0;var s=function(e){return e&&e.__esModule?e:{default:e}}(i("9dlP"));t.default=function(e,t,i){return t in e?(0,s.default)(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}},"9dlP":function(e,t,i){e.exports={default:i("aA0A"),__esModule:!0}},McxH:function(e,t,i){var s=i("6qcy");s(s.S+s.F*!i("m4jn"),"Object",{defineProperty:i("yWpJ").f})},NvxJ:function(e,t,i){},PanD:function(e,t,i){"use strict";var s=i("ZOPr");i.n(s).a},QbLD:function(e,t,i){"use strict";i.r(t);var s=i("/umX"),o=i.n(s),a=i("EPZ6"),n=i.n(a),r=i("cLjf"),l=i.n(r),d=i("hDQ3"),c=i.n(d),u=i("8SHQ"),f={data:function(){return{Host:u.a,imageBaseUrl:u.b,form:{mainTitle:"",fileFormat:"",content:"",studyFileInfoList:[],studyOpenInfoList:[],openType:"",downloadState:"1",publishState:""},rules:{mainTitle:[{required:!0,message:"请输入标题",trigger:"change"}],content:[{required:!0,message:"请输入正文",trigger:"change"}],openType:[{required:!0,message:"请选择公开对象",trigger:"change"}],downloadState:[{required:!0,message:"请选择是否可下载",trigger:"change"}],studyFileInfoList:[{required:!0,message:"请上传音频",trigger:"change"}]},hasUploading:!1,fileLists:[],showPublishSet:!0,createdTime:"",videoUrls:"",filePaths:["fileAdd","fileEdit","fileDetail"],audioPaths:["audioAdd","audioEdit","audioDetail"]}},computed:{disabled:function(){return"fileDetail"===this.whichOperate||"audioDetail"===this.whichOperate}},created:function(){this.getWhich(),"fileAdd"!==this.whichOperate&&"audioAdd"!==this.whichOperate&&this.getDetail(),this.disabled&&(this.showPublishSet=!1)},methods:{getWhich:function(){var e=this.$route.path.split("/");this.whichOperate=e[e.length-1],this.form.fileFormat=this.filePaths.includes(this.whichOperate)?"文件":"视频"},radioClick:function(e,t){this.form.openType!==t&&this.$refs.person.clearCheckbox()},getDetail:function(){var e=this;return c()(l.a.mark(function t(){var i;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$post("studyDataGetStudyDataById",{id:e.$route.query.id});case 2:"1000"===(i=t.sent).returnCode?(e.echo(i.dataInfo),e.createdTime=i.dataInfo.createdTime):e.$message.error(i.message);case 4:case"end":return t.stop()}},t,e)}))()},echo:function(e){var t={};if(n()(this.form).forEach(function(i){t[i]=e[i]}),t.content=this.$base64.decode(t.content),"1"===t.openType)t.studyOpenInfoList=[];else{var i=void 0;switch(t.openType){case"2":i="groupId";break;case"3":i="roleId";break;case"4":i="userId"}t.studyOpenInfoList=t.studyOpenInfoList.map(function(e){return e[i]})}t.studyFileInfoList&&t.studyFileInfoList.length?t.studyFileInfoList=this.fileLists=t.studyFileInfoList.map(function(e){return{name:e.fileName,url:e.fileUrl}}):t.studyFileInfoList=[],this.form=t,"视频"===this.form.fileFormat&&(this.videoUrls=this.form.studyFileInfoList[0].url),console.log("form",this.form)},submitForm:function(e,t){var i=this;this.$refs[e].validate(function(e){if(!e)return i.$message.error("有信息未填写"),!1;"1"===i.form.openType||i.form.studyOpenInfoList&&i.form.studyOpenInfoList.length?i.hasUploading?i.$message.warning("有文件正在上传中"):i.operateData(t):i.$message.error("公开对象人员未勾选")})},operateData:function(e){var t=this.$deepCopy(this.form);t.publishState=e,t.content=this.$base64.encode(t.content);var i=void 0,s=[];if(t.studyOpenInfoList.length){switch(t.openType){case"2":i="groupId";break;case"3":i="roleId";break;case"4":i="userId"}t.studyOpenInfoList.forEach(function(e){s.push(o()({},i,e))})}t.studyOpenInfoList=s,t.studyFileInfoList.length&&(t.studyFileInfoList=t.studyFileInfoList.map(function(e){return{fileName:e.fileName||e.name,fileUrl:e.filePath||e.url}})),this.$route.query.id&&(t.id=this.$route.query.id),this.save(t)},save:function(e){var t=this;return c()(l.a.mark(function i(){var s;return l.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,t.$post("studyDataSaveOrUpdateStudyData",e);case 2:"1000"===(s=i.sent).returnCode?(t.$message.success("操作成功"),t.$router.go(-1)):t.$message.error(s.message);case 4:case"end":return i.stop()}},i,t)}))()},audioBeforeUpload:function(e){var t=new FileReader;console.log("reader",t),console.log("file",e)},audioUploadSuccess:function(e){console.log("files",e),this.videoUrls=e.filePath}}},m=(i("jJH6"),i("PanD"),i("ZrdR")),p=Object(m.a)(f,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"study_datum_file_add"},[i("el-form",{ref:"form",staticClass:"form",attrs:{model:e.form,rules:e.rules,"label-width":"120px"}},[e.disabled?i("el-row",[i("el-row",{staticClass:"main_title_row"},[i("h3",[e._v(e._s(e.form.mainTitle))])]),e._v(" "),i("el-row",{staticClass:"created_time_row"},[i("span",{staticClass:"created_time"},[e._v("发布时间："+e._s(e._f("filterTime")(e.createdTime,"YYYY-MM-DD hh:mm")))]),e._v(" "),i("span",[e._v("格式："+e._s(e.form.fileFormat))])])],1):i("el-row",[i("el-col",{attrs:{span:7}},[i("el-form-item",{attrs:{label:"标题：",prop:"mainTitle"}},[i("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form.mainTitle,callback:function(t){e.$set(e.form,"mainTitle",t)},expression:"form.mainTitle"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:7}},[i("el-form-item",{attrs:{label:"格式：",prop:"fileFormat"}},[e._v("\n          "+e._s(e.form.fileFormat)+"\n        ")])],1)],1),e._v(" "),e.filePaths.includes(e.whichOperate)?[i("el-row",{staticClass:"content_row"},[i("el-col",{attrs:{span:21}},[e.disabled?i("el-form-item",[i("div",{domProps:{innerHTML:e._s(e.form.content)}})]):i("el-form-item",{attrs:{label:"正文：",prop:"content"}},[i("tinymce",{model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}}),e._v(" "),i("el-input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1)],1)],1),e._v(" "),i("el-row",[i("el-col",{attrs:{span:21}},[e.disabled?i("el-form-item",{attrs:{label:"附件："}},e._l(e.form.studyFileInfoList,function(t,s){return i("div",{key:s},[i("span",[e._v(e._s(t.name))]),e._v(" "),i("a",{attrs:{href:e.Host+"file/download?filePath="+t.url+"&fileName="+t.name}},[e._v("下载")])])})):i("el-form-item",{attrs:{label:"上传文件："}},[i("file-upload",{attrs:{hasUploading:e.hasUploading,fileLists:e.fileLists,disabled:e.disabled},on:{"update:hasUploading":function(t){e.hasUploading=t}},model:{value:e.form.studyFileInfoList,callback:function(t){e.$set(e.form,"studyFileInfoList",t)},expression:"form.studyFileInfoList"}})],1)],1)],1)]:e._e(),e._v(" "),e.audioPaths.includes(e.whichOperate)?[e.disabled?e._e():i("el-row",[i("el-col",{attrs:{span:21}},[i("el-form-item",{attrs:{label:"音频：",prop:"studyFileInfoList"}},[i("file-upload",{attrs:{hasUploading:e.hasUploading,fileLists:e.fileLists,limit:1,disabled:e.disabled},on:{"update:hasUploading":function(t){e.hasUploading=t},beforeUpload:e.audioBeforeUpload,getFiles:e.audioUploadSuccess,removeFile:function(t){e.videoUrls=""}},model:{value:e.form.studyFileInfoList,callback:function(t){e.$set(e.form,"studyFileInfoList",t)},expression:"form.studyFileInfoList"}})],1)],1)],1),e._v(" "),i("el-row",[i("el-col",{class:{center_video:e.disabled},attrs:{span:21}},[i("el-form-item",[i("video",{attrs:{width:"800",height:"600",controls:"",src:e.imageBaseUrl+e.videoUrls}})])],1)],1)]:e._e(),e._v(" "),e.disabled?i("el-row",[i("el-form-item",{attrs:{label:"发布设置："}},[i("i",{directives:[{name:"show",rawName:"v-show",value:!e.showPublishSet,expression:"!showPublishSet"}],staticClass:"el-icon-caret-bottom",on:{click:function(t){e.showPublishSet=!e.showPublishSet}}}),e._v(" "),i("i",{directives:[{name:"show",rawName:"v-show",value:e.showPublishSet,expression:"showPublishSet"}],staticClass:"el-icon-caret-top",on:{click:function(t){e.showPublishSet=!e.showPublishSet}}})])],1):e._e(),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showPublishSet,expression:"showPublishSet"}]},[i("el-row",[i("el-col",{attrs:{span:21}},[i("el-form-item",{attrs:{label:"公开对象：",prop:e.disabled?"":"openType","label-width":e.disabled?"200px":"120px"}},[i("el-radio-group",{attrs:{disabled:e.disabled},model:{value:e.form.openType,callback:function(t){e.$set(e.form,"openType",t)},expression:"form.openType"}},[i("el-radio",{attrs:{label:"1"},nativeOn:{click:function(t){e.radioClick(t,"1")}}},[e._v("全部成员")]),e._v(" "),i("el-radio",{attrs:{label:"2"},nativeOn:{click:function(t){e.radioClick(t,"2")}}},[e._v("指定招生组")]),e._v(" "),i("el-radio",{attrs:{label:"3"},nativeOn:{click:function(t){e.radioClick(t,"3")}}},[e._v("指定角色")]),e._v(" "),i("el-radio",{attrs:{label:"4"},nativeOn:{click:function(t){e.radioClick(t,"4")}}},[e._v("自定义成员")])],1)],1)],1)],1),e._v(" "),i("specified-object",{ref:"person",attrs:{type:e.form.openType,disabled:e.disabled},model:{value:e.form.studyOpenInfoList,callback:function(t){e.$set(e.form,"studyOpenInfoList",t)},expression:"form.studyOpenInfoList"}})],1),e._v(" "),i("div",{staticClass:"btn_container"},[i("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.disabled,expression:"!disabled"}],attrs:{type:"primary",size:"mini"},on:{click:function(t){e.submitForm("form","1")}}},[e._v("发布")]),e._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.disabled,expression:"!disabled"}],attrs:{type:"primary",size:"mini"},on:{click:function(t){e.submitForm("form","2")}}},[e._v("暂存")]),e._v(" "),i("el-button",{attrs:{size:"mini"},on:{click:function(t){e.$router.go(-1)}}},[e._v("返回")])],1)],2)],1)},[],!1,null,"1d1fc767",null);p.options.__file="file.vue";t.default=p.exports},ZOPr:function(e,t,i){},aA0A:function(e,t,i){i("McxH");var s=i("o4ww").Object;e.exports=function(e,t,i){return s.defineProperty(e,t,i)}},jJH6:function(e,t,i){"use strict";var s=i("NvxJ");i.n(s).a}}]);