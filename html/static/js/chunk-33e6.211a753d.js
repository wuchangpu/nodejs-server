(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-33e6"],{"Ls/j":function(e,t,a){"use strict";a.r(t);var i=a("cLjf"),r=a.n(i),n=a("hDQ3"),o=a.n(n),s=a("6ZY3"),l=a.n(s),m=a("zqH/"),f=a("8SHQ"),c={data:function(){return{formData:{title:"",eventObject:"",eventBegin:"",eventEnd:"",content:"",fileName:"",filePath:"",informType:"",orgList:"",roleList:"",userList:"",informTimely:"",hintTime:"",status:""},copyData:{},ruler:{title:{required:!0,message:"请输入",trigger:"blur"},eventObject:{required:!0,message:"请选择",trigger:"change"},eventBegin:{required:!0,message:"请选择",trigger:"change"},eventEnd:{required:!0,message:"请选择",trigger:"change"},content:{required:!0,message:"请输入",trigger:"blur"},filePath:{required:!0,message:"请上传",trigger:"blur"},informType:{required:!0,message:"请选择",trigger:"blur"},orgList:{required:!0,message:"请选择",trigger:"change"},informTimely:{required:!0,message:"请选择",trigger:"change"},hintTime:{required:!0,message:"请选择",trigger:"change"}},timeRange:[],pickerOptions:{disabledDate:function(e){return e.getTime()>Date.now()}},pickerOptions1:{disabledDate:function(e){return e.getTime()<Date.now()}},fileList:[],id:"",isEdit:!1,isTemporarySave:!1}},created:function(){this.id=this.$route.query.id,this.id&&this.getDetailAction()},watch:{timeRange:function(){this.timeRange&&this.timeRange.length&&l()(this.formData,{eventEnd:this.timeRange[1].getTime(),eventBegin:this.timeRange[0].getTime()})}},methods:{getFiles:function(e){this.fileList.push({name:e.fileName,url:f.b+e.filePath})},removeFile:function(e){console.log(e),this.fileList=e.fileList},radioClick:function(e,t){this.formData.informType!==t&&(this.formData.orgList=[],this.$refs.person.clearCheckbox())},getDetailAction:function(){var e=this;return o()(r.a.mark(function t(){var a,i,n;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$post("RateDetail",{id:e.id});case 2:if("1000"!==(a=t.sent).returnCode){t.next=25;break}e.copyData=e.$deepCopy(a.dataInfo),e.formData={title:a.dataInfo.title,eventObject:a.dataInfo.eventObject,eventBegin:a.dataInfo.eventBegin,eventEnd:a.dataInfo.eventEnd,content:m.Base64.decode(a.dataInfo.content),fileName:a.dataInfo.fileName,filePath:a.dataInfo.filePath,informType:a.dataInfo.informType,orgList:a.dataInfo.orgList,roleList:[],userList:[],informTimely:a.dataInfo.informTimely,hintTime:a.dataInfo.hintTime,status:a.dataInfo.status},t.t0=e.formData.informType,t.next="1"===t.t0?9:"2"===t.t0?11:"3"===t.t0?13:"4"===t.t0?15:17;break;case 9:return l()(e.formData,{orgList:[],roleList:[],userList:[]}),t.abrupt("break",18);case 11:return l()(e.formData,{orgList:a.dataInfo.orgList,roleList:[],userList:[]}),t.abrupt("break",18);case 13:return l()(e.formData,{orgList:a.dataInfo.roleList,roleList:[],userList:[]}),t.abrupt("break",18);case 15:return l()(e.formData,{orgList:a.dataInfo.userList,roleList:[],userList:[]}),t.abrupt("break",18);case 17:return t.abrupt("break",18);case 18:"1"===e.formData.status||""===e.formData.status?e.isTemporarySave=!0:e.isEdit=!0,console.log(e.formData.status),i=e.formData.fileName.split(","),n=e.formData.filePath.split(","),e.fileList=n.map(function(e,t){return{name:i[t],url:f.b+e}}),e.timeRange=[new Date(+a.dataInfo.eventBegin),new Date(+a.dataInfo.eventEnd)],t.next=26;break;case 25:return t.abrupt("return",e.$message.error(a.message));case 26:case"end":return t.stop()}},t,e)}))()},onClickSaveBtn:function(e){var t=this,a=this.$deepCopy(this.formData.orgList);switch(this.formData.informType){case"1":this.formData.orgList=[],this.formData.roleList=[],this.formData.userList=[];break;case"2":this.formData.orgList=a,this.formData.roleList=[],this.formData.userList=[];break;case"3":this.formData.roleList=a,this.formData.orgList=[],this.formData.userList=[];break;case"4":this.formData.userList=a,this.formData.orgList=[],this.formData.roleList=[]}var i=[],r=[],n=[];if(this.fileList.forEach(function(e){n.push(e.status),e.response?(i.push(JSON.parse(e.response.dataInfo).filePath),r.push(JSON.parse(e.response.dataInfo).fileName)):(i.push(e.url.slice(e.url.indexOf(f.b)+f.b.length)),r.push(e.name))}),!n.every(function(e){return"success"===e}))return this.$message.error("有图片未上传成功，请等待或重试");this.formData.fileName=r.join(","),this.formData.filePath=i.join(","),this.timeRange&&this.timeRange.length&&l()(this.formData,{eventEnd:this.timeRange[1].getTime(),eventBegin:this.timeRange[0].getTime()}),this.$refs.formData.validate(function(a){return a&&t.handleSaveAction(e)})},handleSaveAction:function(e){var t=this;return o()(r.a.mark(function a(){var i,n,o;return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return i=t.$deepCopy(t.formData),l()(i,{content:m.Base64.encode(t.formData.content),status:e}),(t.isEdit||t.isTemporarySave)&&l()(i,{content:m.Base64.encode(t.formData.content),status:e,id:t.id,updateTitle:t.copyData.title,updateContent:t.copyData.title+" 已更新，活动标题由原“"+t.copyData.title+"”调整为“"+i.title+"”，可前往评优管理页面查看最新活动信息。"}),n=t.isEdit||t.isTemporarySave?"RateEdit":"RateAdd",a.next=6,t.$post(n,i);case 6:if("1000"!==(o=a.sent).returnCode){a.next=12;break}t.$message.success("操作成功"),t.$router.replace({name:"RateActivityList"}),a.next=13;break;case 12:return a.abrupt("return",t.$message.error(o.message));case 13:case"end":return a.stop()}},a,t)}))()},onClickCancelBtn:function(){this.$router.replace({name:"RateActivityList"})}}},u=(a("fviE"),a("ZrdR")),d=Object(u.a)(c,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"rate-activity-add"}},[a("el-form",{ref:"formData",staticClass:"form",attrs:{model:e.formData,"label-width":"120px",rules:e.ruler}},[a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{prop:"title",label:"活动名称："}},[a("el-input",{model:{value:e.formData.title,callback:function(t){e.$set(e.formData,"title",t)},expression:"formData.title"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{prop:"eventObject",label:"活动对象："}},[a("el-select",{model:{value:e.formData.eventObject,callback:function(t){e.$set(e.formData,"eventObject",t)},expression:"formData.eventObject"}},[a("el-option",{attrs:{label:"招生干部",value:"1"}}),e._v(" "),a("el-option",{attrs:{label:"招生组长",value:"2"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{staticClass:"date-form-item",attrs:{prop:"eventBegin",label:"活动时间："}},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",clearable:"","default-time":["00:00:00","23:59:59"]},model:{value:e.timeRange,callback:function(t){e.timeRange=t},expression:"timeRange"}})],1)],1)],1),e._v(" "),a("div",[a("el-form-item",{attrs:{label:"活动描述：",prop:"content"}},[a("tinymce",{model:{value:e.formData.content,callback:function(t){e.$set(e.formData,"content",t)},expression:"formData.content"}})],1)],1),e._v(" "),a("div",[a("el-form-item",{attrs:{label:"活动宣传图：",prop:"filePath"}},[a("file-upload",{attrs:{fileLists:e.fileList,"list-type":"picture"},on:{getFiles:e.getFiles,removeFile:e.removeFile}})],1)],1),e._v(" "),a("div",[a("el-form-item",{attrs:{label:"通知对象：",prop:"informType"}},[a("el-radio-group",{attrs:{disabled:!e.isTemporarySave&&e.isEdit},model:{value:e.formData.informType,callback:function(t){e.$set(e.formData,"informType",t)},expression:"formData.informType"}},[a("el-radio",{attrs:{label:"1"},nativeOn:{click:function(t){e.radioClick(t,"1")}}},[e._v("全部成员")]),e._v(" "),a("el-radio",{attrs:{label:"2"},nativeOn:{click:function(t){e.radioClick(t,"2")}}},[e._v("指定招生组")]),e._v(" "),a("el-radio",{attrs:{label:"3"},nativeOn:{click:function(t){e.radioClick(t,"3")}}},[e._v("指定角色")]),e._v(" "),a("el-radio",{attrs:{label:"4"},nativeOn:{click:function(t){e.radioClick(t,"4")}}},[e._v("自定义成员")])],1)],1)],1),e._v(" "),a("specified-object",{ref:"person",attrs:{type:e.formData.informType,disabled:!e.isTemporarySave&&e.isEdit},model:{value:e.formData.orgList,callback:function(t){e.$set(e.formData,"orgList",t)},expression:"formData.orgList"}}),e._v(" "),a("div",[a("el-form-item",{attrs:{label:"是否及时通知：",prop:"informTimely"}},[a("el-radio-group",{attrs:{disabled:!e.isTemporarySave&&e.isEdit},model:{value:e.formData.informTimely,callback:function(t){e.$set(e.formData,"informTimely",t)},expression:"formData.informTimely"}},[a("el-radio",{attrs:{label:"2"}},[e._v("否")]),e._v(" "),a("el-radio",{attrs:{label:"1"}},[e._v("是")])],1)],1),e._v(" "),"1"===e.formData.informTimely?a("el-form-item",{attrs:{label:"提示时间：",prop:"hintTime"}},[a("el-date-picker",{attrs:{type:"date","picker-options":e.pickerOptions1,"value-format":"timestamp",disabled:!e.isTemporarySave&&e.isEdit},model:{value:e.formData.hintTime,callback:function(t){e.$set(e.formData,"hintTime",t)},expression:"formData.hintTime"}})],1):e._e()],1),e._v(" "),a("div",{staticStyle:{"text-align":"center"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.onClickSaveBtn(2)}}},[e._v("确定")]),e._v(" "),"1"===e.formData.status||""===e.formData.status?a("el-button",{attrs:{type:"info"},on:{click:function(t){e.onClickSaveBtn(1)}}},[e._v("暂存")]):e._e(),e._v(" "),a("el-button",{on:{click:e.onClickCancelBtn}},[e._v("取消")])],1)],1)],1)},[],!1,null,"0b55e285",null);d.options.__file="add.vue";t.default=d.exports},fviE:function(e,t,a){"use strict";var i=a("qTKY");a.n(i).a},qTKY:function(e,t,a){}}]);